<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
</head>
<body>
  <div id="blocklyDiv" style="height:350px;width:100%;"></div>
  <button id="run">Run</button>
  <canvas id="canvas" width="400" height="300" style="border:1px solid #ccc"></canvas>

  <xml id="toolbox" style="display:none">
    <block type="move"></block>
  </xml>

  <script>
    const workspace = Blockly.inject('blocklyDiv', { toolbox: document.getElementById('toolbox') });
    const ctx = document.getElementById('canvas').getContext('2d');
    let x = 50, y = 150;

    Blockly.Blocks['move'] = {
      init: function() {
        this.appendDummyInput().appendField('move 20');
        this.setPreviousStatement(true);
        this.setNextStatement(true);
        this.setColour(120);
      }
    };
    Blockly.JavaScript['move'] = () => 'x += 20;\n';

    document.getElementById('run').onclick = () => {
      const code = Blockly.JavaScript.workspaceToCode(workspace);
      x = 50; y = 150;
      ctx.clearRect(0,0,400,300);
      try {
        new Function('x','y', code + 'ctx.fillRect(x,y,10,10);')(x, y);
      } catch (e) {
        alert('Error: '+e.message);
      }
    };
  </script>
</body>
</html>
